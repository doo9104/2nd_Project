<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
         xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
         layout:decorator="layout/default"
         xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<div layout:fragment="content">
    <section id="portfolio" class="portfolio">
        <div class="container" style="margin-top: 30px;">
            <form>
                <small>제목</small>
                <input class="form-control" type="text" id="title" name="title"/>
                <small>내용</small>
                <textarea class="form-control" id="content" name="content"></textarea>
                <p>맨 위 사진이 대표 사진으로 등록됩니다.</p>
                <img id="thumbnail" src="/assets/img/blank.png" width="300" height="300">
                <!--<small>작성자</small>-->
                <input type="hidden" class="form-control"  id="writer" name="writer" th:value="${#authentication.getName()}" readonly />
            </form>
            <button class="btn btn-primary" type="button" id="btn-save">등록</button>
        </div>
    </section>

    <div class="d-lg-none scroll-to-top position-fixed rounded"><a
            class="d-block js-scroll-trigger text-center text-white rounded" href="#page-top"><i
            class="fa fa-chevron-up"></i></a></div>

</div>

<th:block layout:fragment="script">
    <script th:inline="javascript" th:src="@{'/assets/js/summernote-image-attributes.js'}"></script>
    <script th:inline="javascript">
        var img = $("#thumbnail").attr("src");
        $('#content').summernote({
            imageAttributes: {
                icon: '<i class="note-icon-pencil"/>',
                figureClass: 'figureClass',
                figcaptionClass: 'captionClass',
                captionText: 'Caption Goes Here.',
                manageAspectRatio: true // true = Lock the Image Width/Height, Default to true
            },
            popover: {
                image: [
                    ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
                    ['float', ['floatLeft', 'floatRight', 'floatNone']],
                    ['remove', ['removeMedia']],
                    ['custom', ['imageAttributes']],
                ],
            },
            //height: 500,                 // 에디터 높이
            minHeight: 500,             // 최소 높이
            maxHeight: null,             // 최대 높이
            focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
            lang: "ko-KR",					// 한글 설정
            spellCheck: false,
            placeholder: '최대 2048자까지 쓸 수 있습니다',	//placeholder 설정
            callbacks: {	//여기 부분이 이미지를 첨부하는 부분
                onImageUpload : function(files) {
                    for (var i = files.length - 1; i >= 0; i--) {
                        uploadSummernoteImageFile(files[i], this);
                    }
                },
                onMediaDelete : function(file) {
                    deleteFile(file[0].src);
                }
            }

        });
        $("div.note-editable").on('drop',function(e){
            for(i=0; i< e.originalEvent.dataTransfer.files.length; i++){
                uploadSummernoteImageFile(e.originalEvent.dataTransfer.files[i],$("#summernote")[0]);
            }
            e.preventDefault();
        });
        /**
         * 이미지 파일 업로드
         */
        function uploadSummernoteImageFile(file, editor) {
            data = new FormData();
            data.append("file", file);
            $.ajax({
                data : data,
                type : "POST",
                url : "/uploadSummernoteImageFile",
                contentType : false,
                processData : false,
                success : function(data) {
                    $(editor).summernote('insertImage', data.url);
                    $("#thumbnail").attr("src",data.url);
                    img = $("#thumbnail").attr("src");
                }
            });
        }

        // 이미지 삭제
        function deleteFile(src) {
            data = new FormData();
            data.append("src", src);
            $.ajax({
                data: data,
                type: "POST",
                contentType : false,
                processData : false,
                url: "/deleteSummernoteImageFile",
                cache: false,
                success: function(resp) {
                    $("#thumbnail").attr("src","/assets/img/blank.png");
                    img = $("#thumbnail").attr("src");
                }
            });
        }



    </script>
</th:block>


</html>